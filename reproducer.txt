Reproducer

Environment variable to set to the location of the where entity-jts1 & entity-jts2 are extracted:
	export EJB3_TUTORIAL_HOME=/folder/where/entity-jts1 & entity-jts2 were extracted

Instances should be managed in separate consoles:
for jboss-eap-5.1-1
	export JBOSS_HOME=/path/to/5.1-1

for jboss-eap-5.1-2
	export JBOSS_HOME=/path/to/5.1-2

	
clean EAP instances:
	[jolee@jolee JTS-Test]$ tree -d -L 2
	.
	|-- jboss-eap-5.1-1
	|   |-- jboss-as
	|   |-- mod_cluster
	|   |-- picketlink
	|   |-- resteasy
	|   `-- seam
	`-- jboss-eap-5.1-2
	    |-- jboss-as
	    |-- mod_cluster
	    |-- picketlink
	    |-- resteasy
	    `-- seam
    
Each server will need the mysql-connector-java-5.1.21-bin.jar (included in the zip):
	jboss-eap-5.1-1/jboss-as/server/all/lib/mysql-connector-java-5.1.21-bin.jar
	jboss-eap-5.1-2/jboss-as/server/all/lib/mysql-connector-java-5.1.21-bin.jar

Each server will need the mysql-xa-ds.xml (included in the zip) 
	jboss-eap-5.1-1/jboss-as/server/all/deploy/mysql-xa-ds.xml
	jboss-eap-5.1-2/jboss-as/server/all/deploy/mysql-xa-ds.xml

Install JTS onto both servers
	[jolee@jolee transactions]$ ant jts
	Buildfile: /opt/jboss/JTS-Test/jboss-eap-5.1-1/jboss-as/docs/examples/transactions/build.xml
	
	jts:
	     [move] Moving 1 file to /opt/jboss/JTS-Test/jboss-eap-5.1-1/jboss-as/server/all/conf
	     [copy] Copying 1 file to /opt/jboss/JTS-Test/jboss-eap-5.1-1/jboss-as/server/all/conf
	     [echo] Transaction service configuration file installed.
	
	modify-jts-config-files:
	     [echo] JBossAS config files updated to run JTS in config ../../../server/all
	
	BUILD SUCCESSFUL
	Total time: 0 seconds
	
	[jolee@jolee transactions]$ ant jts
	Buildfile: /opt/jboss/JTS-Test/jboss-eap-5.1-2/jboss-as/docs/examples/transactions/build.xml
	
	jts:
	     [move] Moving 1 file to /opt/jboss/JTS-Test/jboss-eap-5.1-2/jboss-as/server/all/conf
	     [copy] Copying 1 file to /opt/jboss/JTS-Test/jboss-eap-5.1-2/jboss-as/server/all/conf
	     [echo] Transaction service configuration file installed.
	
	modify-jts-config-files:
	     [echo] JBossAS config files updated to run JTS in config ../../../server/all
	
	BUILD SUCCESSFUL
	Total time: 0 seconds

Make sure you have MySQL
	[jolee@jolee JTS-Test]$ sudo systemctl start mysqld.service
	[sudo] password for jolee: 
	[jolee@jolee JTS-Test]$ systemctl status mysqld.service
	mysqld.service - MySQL database server
		  Loaded: loaded (/usr/lib/systemd/system/mysqld.service; disabled)
		  Active: active (running) since Wed, 22 Aug 2012 15:26:18 -0500; 7s ago
		 Process: 459 ExecStartPost=/usr/libexec/mysqld-wait-ready $MAINPID (code=exited, status=0/SUCCESS)
		 Process: 440 ExecStartPre=/usr/libexec/mysqld-prepare-db-dir (code=exited, status=0/SUCCESS)
		Main PID: 458 (mysqld_safe)
		  CGroup: name=systemd:/system/mysqld.service
			  ├ 458 /bin/sh /usr/bin/mysqld_safe --basedir=/usr
			  └ 605 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mysqld.log -...

Create the jts_test schema:
	mysql> create database jts_test;
	[jolee@jolee JTS-Test]$ mysqladmin -h localhost -u root create jts_test
	[jolee@jolee JTS-Test]$ mysqlshow -u root
	+--------------------+
	|     Databases      |
	+--------------------+
	| information_schema |
	| jts_test           |
	| mysql              |
	+--------------------+


Start your clustered EAP instances (nodename may need to be updated for the 2nd)
	/opt/jboss/JTS-Test/jboss-eap-5.1-1/jboss-as/bin/run.sh -c all
	/opt/jboss/JTS-Test/jboss-eap-5.1-2/jboss-as/bin/run.sh -c all


Deploy to 5.1-1 & 5.1.2
	/home/jolee/Downloads/ejb3-tutorials/source/entity-jts1/ant
	/home/jolee/Downloads/ejb3-tutorials/source/entity-jts2/ant

Run Client (only jts 1 get's ran)
	/home/jolee/Downloads/ejb3-tutorials/source/entity-jts1/ant run


to change whether Free and NextFree are invoked edit:
	entity-jts1/src/org/jboss/tutorial/entity/bean/ShoppingCartBean.java:51
	entity-jts2/src/org/jboss/tutorial/entity/bean/FreeBean.java:69

after changes deploy (ant) and run (ant run)

A run from me:
iterations: 20 Run time: 22874 ( Free & NextFree)
iterations: 20 Run time: 9643 (Free)









